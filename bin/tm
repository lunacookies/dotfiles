#!/usr/bin/env python3

import subprocess
import time

TMUX = "/usr/local/bin/tmux"


def run(*args):
    output = subprocess.run(list(args), stdout=subprocess.PIPE).stdout
    return output.decode("utf-8").splitlines()


def select(prompt, options):
    print(f"{prompt}: ")

    for idx, (name, _) in enumerate(options):
        print(f"{idx + 1}) {name}")

    choice = int(input("> "))
    _, code = options[choice - 1]
    code()


def available_tmux_sessions():
    return run(TMUX, "list-sessions", "-F", "#S")


def new_session():
    name = input("Enter new session name: ")
    run(TMUX, "new-session", "-s", name)


def attach_session(name):
    run(TMUX, "attach-session", "-t", name)


options = (
    list(
        map(
            lambda session_name: (
                session_name,
                lambda: attach_session(session_name),
            ),
            available_tmux_sessions(),
        )
    )
    + [("New session", new_session)]
)

select("Please choose your session", options)
